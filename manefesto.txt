================================================================================
                    BLACKBOOK PREDICTION MARKET MANIFESTO
                         Layer 2 Ledger System v2.0
================================================================================

                              ğŸ¯ MISSION
================================================================================

Build a decentralized prediction market platform where:
- AI agents discover and propose events from real-world news
- Users launch markets by providing initial liquidity
- Prices are set by a Constant Product Market Maker (CPMM)
- Anyone can be a Liquidity Provider (LP) and earn fees
- Markets self-regulate through economic incentives
- No house edge â€” the platform is neutral

================================================================================
                           ğŸ“ ARCHITECTURE
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BLACKBOOK L2 STACK                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚   AI AGENTS     â”‚â”€â”€â”€â”€â–¶â”‚  PENDING EVENTS â”‚â”€â”€â”€â”€â–¶â”‚  CPMM MARKETS   â”‚      â”‚
â”‚   â”‚   (Scrapers)    â”‚     â”‚  (event.rss)    â”‚     â”‚  (On-Chain)     â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                    â”‚                      â”‚                 â”‚
â”‚                                    â”‚                      â”‚                 â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                           â”‚  User Launches  â”‚    â”‚    Trading    â”‚         â”‚
â”‚                           â”‚  + Deposits LP  â”‚    â”‚   x * y = k   â”‚         â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚   LEDGER LAYER:                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ 9 Test Accounts (ALICE, BOB, ... HOUSE)                          â”‚  â”‚
â”‚   â”‚  â€¢ BB Token ($0.01 USD per token)                                   â”‚  â”‚
â”‚   â”‚  â€¢ Transaction History & Audit Trail                                â”‚  â”‚
â”‚   â”‚  â€¢ Escrow for Locked Liquidity                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   FUTURE: Connect to Layer 1 Blockchain for Consensus & Finality           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                    ğŸ”„ EVENT LIFECYCLE (4 STAGES)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 1: INGESTION (The "Inbox")                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                        â”‚
â”‚                                                                             â”‚
â”‚  WHO:     AI Agents, Scrapers, News Parsers                                 â”‚
â”‚  WHAT:    Discover potential prediction events from:                        â”‚
â”‚           - News articles (ObjectWire, Reuters, etc.)                       â”‚
â”‚           - Sports schedules (NFL, FIFA, NBA)                               â”‚
â”‚           - Crypto events (halvings, upgrades)                              â”‚
â”‚           - Political calendars (elections, votes)                          â”‚
â”‚                                                                             â”‚
â”‚  HOW:     POST /ai/events                                                   â”‚
â”‚           {                                                                 â”‚
â”‚             "source": { "domain": "...", "url": "..." },                    â”‚
â”‚             "event": {                                                      â”‚
â”‚               "title": "Will France win World Cup 2026?",                   â”‚
â”‚               "category": "sports",                                         â”‚
â”‚               "options": ["Yes", "No"],                                     â”‚
â”‚               "confidence": 0.75,                                           â”‚
â”‚               "resolution_date": "2026-07-19"                               â”‚
â”‚             }                                                               â”‚
â”‚           }                                                                 â”‚
â”‚                                                                             â”‚
â”‚  STORAGE: app_state.pending_events (in-memory)                              â”‚
â”‚           Backup: event.rss (XML file)                                      â”‚
â”‚                                                                             â”‚
â”‚  STATUS:  "pending"                                                         â”‚
â”‚                                                                             â”‚
â”‚  RULES:   â›” NO trading allowed                                             â”‚
â”‚           â›” NO liquidity exists                                            â”‚
â”‚           â›” NO on-chain market yet                                         â”‚
â”‚           âœ… Admin can edit/delete garbage events                           â”‚
â”‚           âœ… Events can expire if not launched within X days                â”‚
â”‚                                                                             â”‚
â”‚  ENDPOINTS:                                                                 â”‚
â”‚           GET  /events/pending           - List all pending events          â”‚
â”‚           POST /ai/events                - AI adds new event                â”‚
â”‚           DELETE /events/:id             - Admin removes garbage            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  USER CLICKS "LAUNCH MARKET"  â•‘
                    â•‘  + DEPOSITS INITIAL LIQUIDITY â•‘
                    â•‘  (Minimum: 1,000 BB tokens)   â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 2: SEEDING (The "Kickstarter" Phase)                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚
â”‚                                                                             â”‚
â”‚  WHO:     Any user with sufficient BB tokens                                â”‚
â”‚  WHAT:    Transform pending event into live market                          â”‚
â”‚                                                                             â”‚
â”‚  HOW:     POST /events/:id/launch                                           â”‚
â”‚           {                                                                 â”‚
â”‚             "launcher": "ALICE",                                            â”‚
â”‚             "initial_liquidity": 5000.0,                                    â”‚
â”‚             "betting_closes_at": "2026-07-19T00:00:00Z"                     â”‚
â”‚           }                                                                 â”‚
â”‚                                                                             â”‚
â”‚  WHAT HAPPENS:                                                              â”‚
â”‚  1. Tokens deducted from launcher's balance                                 â”‚
â”‚  2. CPMM Pool initialized with 50/50 split:                                 â”‚
â”‚     - For "Yes/No" market with 5000 BB:                                     â”‚
â”‚     - Pool: { yes_tokens: 2500, no_tokens: 2500 }                           â”‚
â”‚     - k = 2500 * 2500 = 6,250,000 (constant product)                        â”‚
â”‚  3. Launcher receives 100% of LP shares                                     â”‚
â”‚  4. Market created on-chain (HashMap<market_id, CPMMMarket>)                â”‚
â”‚  5. 3-Day countdown timer starts                                            â”‚
â”‚                                                                             â”‚
â”‚  STATUS:  "provisional"                                                     â”‚
â”‚                                                                             â”‚
â”‚  RULES:   âš ï¸ Trading is LIVE but market is in "probation"                   â”‚
â”‚           âš ï¸ Large traders should be cautious (low liquidity)               â”‚
â”‚           âœ… Other users can add liquidity (become LPs)                     â”‚
â”‚           âœ… Users can buy outcome tokens                                   â”‚
â”‚                                                                             â”‚
â”‚  VIABILITY CHECK (after 72 hours):                                          â”‚
â”‚           IF TVL >= 10,000 BB tokens:                                       â”‚
â”‚              â†’ Status: "active" (market is safe, guaranteed to run)         â”‚
â”‚           ELSE:                                                             â”‚
â”‚              â†’ Status: "refunded" (market cancelled)                        â”‚
â”‚              â†’ All LPs get tokens back                                      â”‚
â”‚              â†’ All traders get tokens back                                  â”‚
â”‚                                                                             â”‚
â”‚  ENDPOINTS:                                                                 â”‚
â”‚           POST /events/:id/launch        - Launch market with liquidity     â”‚
â”‚           POST /markets/:id/add-liquidity - Become an LP                    â”‚
â”‚           GET  /markets/:id              - Get market details + TVL         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   72-HOUR VIABILITY CHECK     â•‘
                    â•‘   "The Reaper"                â•‘
                    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
                    â•‘  TVL < 10,000 BB â†’ REFUNDED   â•‘
                    â•‘  TVL >= 10,000 BB â†’ ACTIVE    â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 3: ACTIVE TRADING (The "Robot")                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                                                                             â”‚
â”‚  WHO:     Any user with BB tokens                                           â”‚
â”‚  WHAT:    Trade outcome tokens using CPMM                                   â”‚
â”‚                                                                             â”‚
â”‚  CPMM FORMULA:   x * y = k   (Constant Product)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  Example: "Will France win World Cup?"                                      â”‚
â”‚  Pool: { yes_tokens: 2500, no_tokens: 2500 }                                â”‚
â”‚  k = 6,250,000                                                              â”‚
â”‚                                                                             â”‚
â”‚  User wants to buy 100 YES tokens:                                          â”‚
â”‚  1. New yes_tokens = 2500 - 100 = 2400                                      â”‚
â”‚  2. New no_tokens = k / 2400 = 6,250,000 / 2400 = 2604.17                   â”‚
â”‚  3. Cost = 2604.17 - 2500 = 104.17 BB                                       â”‚
â”‚  4. Fee = 104.17 * 0.02 = 2.08 BB (to LP pool)                              â”‚
â”‚  5. Total cost = 106.25 BB for 100 YES tokens                               â”‚
â”‚                                                                             â”‚
â”‚  PRICE CALCULATION:                                                         â”‚
â”‚  Price(YES) = no_tokens / (yes_tokens + no_tokens)                          â”‚
â”‚  Price(YES) = 2604 / (2400 + 2604) = 52.0%                                  â”‚
â”‚                                                                             â”‚
â”‚  HOW:     POST /markets/:id/trade                                           â”‚
â”‚           {                                                                 â”‚
â”‚             "trader": "BOB",                                                â”‚
â”‚             "outcome": "yes",                                               â”‚
â”‚             "amount": 100.0,        // tokens to buy                        â”‚
â”‚             "max_cost": 110.0       // slippage protection                  â”‚
â”‚           }                                                                 â”‚
â”‚                                                                             â”‚
â”‚  STATUS:  "active"                                                          â”‚
â”‚                                                                             â”‚
â”‚  RULES:   âœ… Trading open until betting_closes_at                           â”‚
â”‚           âœ… Prices move automatically based on supply/demand               â”‚
â”‚           âœ… 2% fee on every trade goes to LP pool                          â”‚
â”‚           âœ… LPs can add/remove liquidity anytime                           â”‚
â”‚           â›” No house edge â€” platform is neutral                            â”‚
â”‚                                                                             â”‚
â”‚  LP MECHANICS:                                                              â”‚
â”‚           â€¢ LPs deposit both outcome tokens proportionally                  â”‚
â”‚           â€¢ LPs receive LP shares (% of pool)                               â”‚
â”‚           â€¢ LPs earn 2% of all trading volume                               â”‚
â”‚           â€¢ LP risk: If outcome is lopsided, LPs may lose                   â”‚
â”‚           â€¢ LP reward: If trading is balanced, LPs profit from fees         â”‚
â”‚                                                                             â”‚
â”‚  ENDPOINTS:                                                                 â”‚
â”‚           POST /markets/:id/trade        - Buy/sell outcome tokens          â”‚
â”‚           POST /markets/:id/add-liquidity - Add liquidity (become LP)       â”‚
â”‚           POST /markets/:id/remove-liquidity - Remove liquidity             â”‚
â”‚           GET  /markets/:id/price        - Get current prices               â”‚
â”‚           GET  /markets/:id/depth        - Get order book depth             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    EVENT DEADLINE REACHED     â•‘
                    â•‘    Betting Closes             â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 4: RESOLUTION (The "Truth")                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚                                                                             â”‚
â”‚  WHO:     Community Oracles (initially Admin)                               â”‚
â”‚  WHAT:    Determine the winning outcome and pay winners                     â”‚
â”‚                                                                             â”‚
â”‚  ORACLE OPTIONS:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  Option A: Admin Resolution (v1 - current)                                  â”‚
â”‚            POST /markets/:id/resolve { "winner": 0, "resolver": "ADMIN" }   â”‚
â”‚                                                                             â”‚
â”‚  Option B: Community Voting (v2 - planned)                                  â”‚
â”‚            â€¢ Token holders vote on outcome                                  â”‚
â”‚            â€¢ 2/3 majority required                                          â”‚
â”‚            â€¢ Dispute period (24 hours)                                      â”‚
â”‚                                                                             â”‚
â”‚  Option C: External Oracle (v3 - future)                                    â”‚
â”‚            â€¢ Chainlink, UMA, or custom oracle                               â”‚
â”‚            â€¢ Automated resolution from data feeds                           â”‚
â”‚                                                                             â”‚
â”‚  RESOLUTION LOGIC:                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  IF oracle reports outcome within 7 days:                                   â”‚
â”‚     â†’ Winner set (e.g., "France" for World Cup)                             â”‚
â”‚     â†’ Winning tokens redeemable 1:1 for $1.00                               â”‚
â”‚     â†’ Losing tokens burn to $0.00                                           â”‚
â”‚                                                                             â”‚
â”‚  ELSE (timeout after 7 days):                                               â”‚
â”‚     â†’ Winner set to "NULL" (fail-safe)                                      â”‚
â”‚     â†’ All tokens refunded at last traded price                              â”‚
â”‚     â†’ Market marked as "disputed"                                           â”‚
â”‚                                                                             â”‚
â”‚  REDEMPTION:                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  POST /markets/:id/redeem                                                   â”‚
â”‚  {                                                                          â”‚
â”‚    "account": "ALICE",                                                      â”‚
â”‚    "outcome_tokens": 100    // 100 winning tokens                           â”‚
â”‚  }                                                                          â”‚
â”‚  â†’ Returns: 100 BB tokens ($1.00 per winning token)                         â”‚
â”‚                                                                             â”‚
â”‚  LP SETTLEMENT:                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  â€¢ LPs receive remaining pool tokens proportional to shares                 â”‚
â”‚  â€¢ If market was balanced: LPs profit from fees                             â”‚
â”‚  â€¢ If market was lopsided: LPs may have impermanent loss                    â”‚
â”‚                                                                             â”‚
â”‚  STATUS:  "resolved"                                                        â”‚
â”‚                                                                             â”‚
â”‚  ENDPOINTS:                                                                 â”‚
â”‚           POST /markets/:id/resolve      - Set winning outcome              â”‚
â”‚           POST /markets/:id/redeem       - Redeem winning tokens            â”‚
â”‚           GET  /markets/:id/settlement   - View settlement details          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                    ğŸ› ï¸ IMPLEMENTATION ROADMAP
================================================================================

PHASE 1: CORE CPMM ENGINE (Week 1)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Step 1.1: Create src/cpmm.rs module
            - CPMMPool struct with x, y, k values
            - swap() function with constant product formula
            - calculate_price() from token ratios
            - calculate_cost() for buying tokens
            - FEE_RATE = 0.02 (2%)

â–¡ Step 1.2: Add EventStatus enum
            - pending, provisional, active, closed, resolved, refunded

â–¡ Step 1.3: Update PredictionMarket struct
            - Add cpmm_pool: CPMMPool
            - Add lp_shares: HashMap<String, f64>
            - Add tvl: f64
            - Add provisional_deadline: Option<u64>
            - Add betting_closes_at: u64

â–¡ Step 1.4: Test CPMM math
            - Unit tests for swap calculations
            - Unit tests for price movements
            - Unit tests for fee collection

PHASE 2: EVENT LIFECYCLE (Week 2)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Step 2.1: Refactor pending events
            - Add app_state.pending_events: Vec<PendingEvent>
            - Separate from ai_events (which includes launched)
            - Update GET /events/pending

â–¡ Step 2.2: Implement /events/:id/launch endpoint
            - Validate event exists and is pending
            - Deduct tokens from launcher
            - Initialize CPMM pool
            - Set status to provisional
            - Set provisional_deadline to now + 72 hours

â–¡ Step 2.3: Implement viability checker
            - Background task (tokio::spawn)
            - Check provisional markets every hour
            - Promote to active if TVL >= 10,000 BB
            - Refund if deadline passed and TVL < 10,000 BB

â–¡ Step 2.4: Test lifecycle transitions
            - Test pending â†’ provisional
            - Test provisional â†’ active
            - Test provisional â†’ refunded

PHASE 3: TRADING ENGINE (Week 3)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Step 3.1: Implement /markets/:id/trade endpoint
            - Call cpmm.swap()
            - Deduct cost from trader
            - Credit outcome tokens
            - Collect fees for LPs
            - Log blockchain activity

â–¡ Step 3.2: Implement /markets/:id/add-liquidity
            - Accept proportional token deposits
            - Mint LP shares
            - Update pool reserves

â–¡ Step 3.3: Implement /markets/:id/remove-liquidity
            - Burn LP shares
            - Return proportional tokens
            - Update pool reserves

â–¡ Step 3.4: Test trading mechanics
            - Test price impact
            - Test slippage protection
            - Test fee collection
            - Test LP add/remove

PHASE 4: RESOLUTION (Week 4)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Step 4.1: Update /markets/:id/resolve
            - Support NULL outcome for timeouts
            - Calculate winning token value
            - Mark losing tokens as worthless

â–¡ Step 4.2: Implement /markets/:id/redeem
            - Verify user holds winning tokens
            - Exchange 1 token for 1 BB
            - Burn redeemed tokens

â–¡ Step 4.3: Implement LP settlement
            - Calculate remaining pool value
            - Distribute to LPs by share
            - Handle impermanent loss

â–¡ Step 4.4: Test resolution
            - Test normal resolution
            - Test timeout/NULL resolution
            - Test redemption
            - Test LP payouts

PHASE 5: PERSISTENCE & POLISH (Week 5)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Step 5.1: Persist launched markets to JSON
            - Write to src/events/{category}/{id}.json
            - Load on server restart

â–¡ Step 5.2: Add market search/filter
            - Filter by category
            - Filter by status
            - Sort by TVL, volume, deadline

â–¡ Step 5.3: Frontend integration
            - Update API responses
            - Add new endpoints to docs

â–¡ Step 5.4: Community voting (future)
            - Token-weighted voting
            - Dispute resolution
            - Slashing for bad actors

================================================================================
                    ğŸ“Š KEY METRICS & CONSTANTS
================================================================================

BB_TOKEN_VALUE_USD     = $0.01        // 1 BB = 1 cent
MINIMUM_LAUNCH_LIQUIDITY = 1,000 BB   // $10 to launch a market
VIABILITY_THRESHOLD    = 10,000 BB    // $100 TVL to pass viability
VIABILITY_PERIOD       = 72 hours     // 3 days probation
LP_FEE_RATE           = 0.02          // 2% trading fee to LPs
RESOLUTION_TIMEOUT     = 7 days       // Time to resolve after event
INITIAL_ODDS          = 0.50          // 50/50 split on launch

================================================================================
                    ğŸ”Œ API ENDPOINTS SUMMARY
================================================================================

EVENTS (Pending)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET    /events/pending                 List all pending events
POST   /ai/events                      AI adds new pending event
DELETE /events/:id                     Admin removes garbage event
POST   /events/:id/launch              User launches market with liquidity

MARKETS (Active)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET    /markets                        List all markets
GET    /markets/:id                    Get market details
GET    /markets/:id/price              Get current prices
POST   /markets/:id/trade              Buy/sell outcome tokens
POST   /markets/:id/add-liquidity      Add liquidity (become LP)
POST   /markets/:id/remove-liquidity   Remove liquidity
POST   /markets/:id/resolve            Resolve with winning outcome
POST   /markets/:id/redeem             Redeem winning tokens for BB

ACCOUNTS
â”€â”€â”€â”€â”€â”€â”€â”€
GET    /accounts                       List all accounts
GET    /balance/:address               Get account balance
POST   /transfer                       Transfer BB tokens
GET    /bets/:account                  Get user's positions

SYSTEM
â”€â”€â”€â”€â”€â”€
GET    /health                         Health check
GET    /ledger/json                    Blockchain activity feed
GET    /ai/events/feed.rss             RSS feed of all events

================================================================================
                    ğŸ¯ SUCCESS CRITERIA
================================================================================

1. FUNCTIONAL
   â–¡ AI agents can submit events to pending queue
   â–¡ Users can launch markets with initial liquidity
   â–¡ CPMM correctly calculates prices and slippage
   â–¡ Viability check promotes/refunds markets correctly
   â–¡ Resolution pays winners and burns losers
   â–¡ LPs earn fees and can exit positions

2. ECONOMIC
   â–¡ No arbitrage opportunities in CPMM math
   â–¡ Fees are collected correctly (2%)
   â–¡ Impermanent loss is calculated accurately
   â–¡ Redemption is exactly 1:1 for winners

3. SAFETY
   â–¡ Cannot trade on pending events
   â–¡ Cannot trade after betting closes
   â–¡ Cannot resolve without oracle/admin
   â–¡ Cannot redeem losing tokens
   â–¡ Refunds work correctly for failed markets

================================================================================
                    ğŸ“ NOTES
================================================================================

â€¢ This system is inspired by Polymarket and Kalshi but uses CPMM instead
  of order books for simpler implementation and guaranteed liquidity.

â€¢ The viability check prevents "ghost markets" with no liquidity from
  cluttering the platform.

â€¢ Community voting for resolution will be added in v2 to reduce
  centralization risk.

â€¢ Future: Connect to Layer 1 blockchain for true decentralization and
  cryptographic finality.

================================================================================
                         END OF MANIFESTO
================================================================================

Last Updated: December 2, 2025
Version: 2.0.0
Authors: BlackBook Team